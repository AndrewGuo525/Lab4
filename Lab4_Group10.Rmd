---
title: "Lab4_Group10"
author: "Jiayi Guo"
date: "2022-11-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE,warning=FALSE}
library(datasets)
library(tidyverse)
library(fields)
```

```{r}
k_means <- function(data, k, iter){
  set.seed(111)
  
  data <- data %>% 
    select(-Species) %>% # Remove the label of data
    mutate(label = sample(1:k, 150, replace = T)) # Randomly assigning each observation to a cluster
  
  centroids <- data %>% # Calculate the centroids for each of the cluster
    group_by(label) %>% 
    summarise(centr <- across(everything(),mean)) %>% 
    select(-label)
  
  for(i in seq_len(iter)){
    # Calculate the distance from each point to each of the centroids 
     dist <- rdist(centroids, data[,-5])
       
    # Calculate the minimum distance for each point to the centroids
     data <- data %>% 
       mutate(label = apply(dist, 2, which.min))
    
    # Calculate the new centroids
    centroids <- data %>% # Calculate the centroids for each of the cluster
      group_by(label) %>% 
      summarise(centr <- across(everything(),mean)) %>% 
      select(-label)
  }
  return(data$label)
}
```

```{r}
label<- k_means(iris,3,50)
table(label)
```

```{r}
iris <- iris %>% 
  mutate(label = as.factor(label))

ggplot(iris)+
  geom_point(aes(x = Sepal.Length, y = Sepal.Width, color = Species))

ggplot(iris)+
  geom_point(aes(x = Sepal.Length, y = Sepal.Width, color = label))
```

```{r}
set.seed(111)

## Clean the names of the data set and remove species 
iris_new <- iris %>% 
  clean_names() %>%
  select(- species) 
## Scale the data
iris_scaled <- scale(iris_new) 
## Try with 3 clusters and 50 iterations.
iris_cluster <- k_means(iris_scaled, k = 3, iter = 50) 
## Return the cluster
iris_cluster

iris_new <- iris_new %>%
  mutate(cluster = as.factor(iris_cluster)) 

## Visualization
ggpairs(iris_new, 
        aes(color = as.factor(cluster)))


```

